<!doctype html>
<html lang="ko">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-31S31HGWZ0"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-31S31HGWZ0');
  </script>
  <!-- Microsoft Clarity -->
  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "v2q4i24zi7");
  </script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI 가위바위보</title>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8992259838992521" crossorigin="anonymous"></script>
  <meta name="google-adsense-account" content="ca-pub-8992259838992521">
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
  <style>
    :root {
      --bg-color: oklch(20% 0.01 234);
      --text-color: oklch(95% 0.01 234);
      --accent-color: oklch(65% 0.2 280);
      --shadow-color: oklch(30% 0.2 280 / 50%);
      --card-bg: oklch(25% 0.01 234);
      --border-color: oklch(35% 0.01 234);
    }

    [data-theme="light"] {
      --bg-color: oklch(95% 0.01 234);
      --text-color: oklch(20% 0.01 234);
      --accent-color: oklch(55% 0.2 280);
      --shadow-color: oklch(50% 0.2 280 / 30%);
      --card-bg: oklch(100% 0 0);
      --border-color: oklch(85% 0.01 234);
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      display: grid;
      place-content: center;
      min-height: 100vh;
      padding: 2rem;
      background-image: linear-gradient(rgba(128,128,128,0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(128,128,128,0.1) 1px, transparent 1px);
      background-size: 20px 20px;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    main {
      text-align: center;
      max-width: 600px;
      width: 100%;
    }

    h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
      background: linear-gradient(135deg, var(--accent-color), oklch(65% 0.2 320));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      color: var(--text-color);
      opacity: 0.7;
      margin-bottom: 2rem;
    }

    #theme-toggle {
      position: fixed;
      top: 1rem;
      right: 1rem;
      padding: 0.5rem 1rem;
      font-size: 1.5rem;
      background-color: var(--accent-color);
      color: var(--text-color);
      border: none;
      border-radius: 50px;
      cursor: pointer;
      box-shadow: 0 2px 10px var(--shadow-color);
      transition: all 0.3s ease;
    }

    #theme-toggle:hover {
      transform: scale(1.1);
    }

    .webcam-container {
      position: relative;
      margin: 0 auto 1.5rem;
      border-radius: 16px;
      overflow: hidden;
      border: 3px solid var(--border-color);
      background-color: var(--card-bg);
    }

    #webcam-canvas {
      display: block;
      width: 100%;
      max-width: 400px;
      border-radius: 13px;
    }

    #start-btn {
      padding: 1rem 2rem;
      font-size: 1.2rem;
      background-color: var(--accent-color);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 4px 15px var(--shadow-color);
      transition: all 0.3s ease;
      width: 100%;
      font-weight: bold;
      margin-bottom: 1.5rem;
    }

    #start-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px var(--shadow-color);
    }

    #start-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .result-section {
      padding: 1.5rem;
      background-color: var(--card-bg);
      border-radius: 16px;
      border: 2px solid var(--border-color);
    }

    .prediction {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.8rem 1rem;
      margin-bottom: 0.5rem;
      background: linear-gradient(135deg, var(--border-color), transparent);
      border-radius: 8px;
      border-left: 4px solid var(--accent-color);
    }

    .prediction:last-child {
      margin-bottom: 0;
    }

    .prediction-label {
      font-weight: bold;
      font-size: 1.1rem;
    }

    .prediction-bar-container {
      flex: 1;
      margin: 0 1rem;
      height: 20px;
      background-color: var(--border-color);
      border-radius: 10px;
      overflow: hidden;
    }

    .prediction-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--accent-color), oklch(65% 0.2 320));
      border-radius: 10px;
      transition: width 0.2s ease;
    }

    .prediction-value {
      min-width: 50px;
      text-align: right;
      font-weight: bold;
    }

    .current-prediction {
      margin-top: 1.5rem;
      padding: 1.5rem;
      background-color: var(--accent-color);
      color: white;
      border-radius: 8px;
      text-align: center;
    }

    .current-prediction .emoji {
      font-size: 4rem;
      display: block;
      margin-bottom: 0.5rem;
    }

    .current-prediction .label {
      font-size: 1.5rem;
      font-weight: bold;
    }

    .loading {
      display: none;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
      margin: 2rem 0;
    }

    .loading.visible {
      display: flex;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid var(--border-color);
      border-top-color: var(--accent-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .hidden {
      display: none;
    }

    @media (max-width: 600px) {
      h1 {
        font-size: 1.8rem;
      }

      #start-btn {
        font-size: 1rem;
        padding: 0.8rem 1.5rem;
      }

      .current-prediction .emoji {
        font-size: 3rem;
      }
    }
  </style>
</head>
<body>
  <button id="theme-toggle">&#127769;</button>
  <main>
    <h1>AI Rock Paper Scissors</h1>
    <p class="subtitle">Show your hand to the webcam!</p>

    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p>Loading AI model...</p>
    </div>

    <button id="start-btn">Start Webcam</button>

    <div class="webcam-container hidden" id="webcam-container">
      <canvas id="webcam-canvas"></canvas>
    </div>

    <div class="result-section hidden" id="result-section">
      <div id="predictions"></div>
      <div class="current-prediction" id="current-prediction">
        <span class="emoji" id="result-emoji">&#9995;</span>
        <span class="label" id="result-label">Ready</span>
      </div>
    </div>
  </main>

  <script>
    const URL = "https://teachablemachine.withgoogle.com/models/a9aTyqP4t/";

    let model, webcam, maxPredictions;

    const emojiMap = {
      'rock': '\u270A',
      'paper': '\u270B',
      'scissors': '\u270C\uFE0F',
      'Rock': '\u270A',
      'Paper': '\u270B',
      'Scissors': '\u270C\uFE0F'
    };

    const themeToggle = document.getElementById('theme-toggle');
    const savedTheme = localStorage.getItem('theme') || 'dark';
    if (savedTheme === 'light') {
      document.body.setAttribute('data-theme', 'light');
      themeToggle.textContent = '\u2600\uFE0F';
    }

    themeToggle.addEventListener('click', () => {
      const isLight = document.body.getAttribute('data-theme') === 'light';
      if (isLight) {
        document.body.removeAttribute('data-theme');
        themeToggle.textContent = '\uD83C\uDF19';
        localStorage.setItem('theme', 'dark');
      } else {
        document.body.setAttribute('data-theme', 'light');
        themeToggle.textContent = '\u2600\uFE0F';
        localStorage.setItem('theme', 'light');
      }
    });

    async function init() {
      const loading = document.getElementById('loading');
      const startBtn = document.getElementById('start-btn');
      const webcamContainer = document.getElementById('webcam-container');
      const resultSection = document.getElementById('result-section');

      startBtn.classList.add('hidden');
      loading.classList.add('visible');

      const modelURL = URL + "model.json";
      const metadataURL = URL + "metadata.json";

      model = await tmImage.load(modelURL, metadataURL);
      maxPredictions = model.getTotalClasses();

      const flip = true;
      webcam = new tmImage.Webcam(400, 400, flip);
      await webcam.setup();
      await webcam.play();

      loading.classList.remove('visible');
      webcamContainer.classList.remove('hidden');
      resultSection.classList.remove('hidden');

      const canvas = document.getElementById('webcam-canvas');
      canvas.width = 400;
      canvas.height = 400;

      const predictionsDiv = document.getElementById('predictions');
      predictionsDiv.innerHTML = '';
      for (let i = 0; i < maxPredictions; i++) {
        const predDiv = document.createElement('div');
        predDiv.className = 'prediction';
        predDiv.innerHTML = `
          <span class="prediction-label" id="label-${i}">-</span>
          <div class="prediction-bar-container">
            <div class="prediction-bar" id="bar-${i}" style="width: 0%"></div>
          </div>
          <span class="prediction-value" id="value-${i}">0%</span>
        `;
        predictionsDiv.appendChild(predDiv);
      }

      window.requestAnimationFrame(loop);
    }

    async function loop() {
      webcam.update();
      const canvas = document.getElementById('webcam-canvas');
      const ctx = canvas.getContext('2d');
      ctx.drawImage(webcam.canvas, 0, 0);
      await predict();
      window.requestAnimationFrame(loop);
    }

    async function predict() {
      const prediction = await model.predict(webcam.canvas);

      let maxProb = 0;
      let maxClass = '';

      for (let i = 0; i < maxPredictions; i++) {
        const className = prediction[i].className;
        const probability = prediction[i].probability;

        document.getElementById(`label-${i}`).textContent = className;
        document.getElementById(`bar-${i}`).style.width = (probability * 100) + '%';
        document.getElementById(`value-${i}`).textContent = (probability * 100).toFixed(0) + '%';

        if (probability > maxProb) {
          maxProb = probability;
          maxClass = className;
        }
      }

      const resultEmoji = document.getElementById('result-emoji');
      const resultLabel = document.getElementById('result-label');

      if (maxProb > 0.7) {
        resultEmoji.textContent = emojiMap[maxClass] || '\u2753';
        resultLabel.textContent = maxClass;
      } else {
        resultEmoji.textContent = '\u2753';
        resultLabel.textContent = 'Show your hand!';
      }
    }

    document.getElementById('start-btn').addEventListener('click', init);
  </script>
</body>
</html>
