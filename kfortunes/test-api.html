<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Saju Fortune API Test</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      max-width: 900px; margin: 0 auto; padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    h1 { color: white; text-align: center; }
    .card { background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.2); }
    label { display: block; margin-bottom: 5px; font-weight: 600; color: #333; }
    select, input, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 15px; font-size: 14px; }
    .row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
    button { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 15px 30px; border-radius: 8px; cursor: pointer; font-size: 16px; width: 100%; }
    button:hover { opacity: 0.9; }
    button:disabled { opacity: 0.5; }
    .tabs { display: flex; gap: 10px; margin-bottom: 15px; }
    .tab { padding: 10px 20px; border-radius: 20px; cursor: pointer; background: #f0f0f0; border: none; }
    .tab.active { background: #667eea; color: white; }
    #result { white-space: pre-wrap; font-family: monospace; font-size: 12px; background: #1e1e1e; color: #d4d4d4; padding: 20px; border-radius: 8px; overflow-x: auto; max-height: 600px; overflow-y: auto; }
    .loading { text-align: center; padding: 40px; }
    .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #667eea; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .api-toggle { margin-bottom: 20px; }
  </style>
</head>
<body>
  <h1>Saju Fortune API Test</h1>

  <div class="card api-toggle">
    <div class="tabs">
      <button class="tab active" onclick="setAPI('fortune')">Basic Fortune (fortune.js)</button>
      <button class="tab" onclick="setAPI('consultation')">Detailed Consultation (saju-consultation.js)</button>
    </div>
  </div>

  <div class="card">
    <label>Language / 언어</label>
    <select id="language">
      <option value="ko">한국어</option>
      <option value="en">English</option>
      <option value="ja">日本語</option>
      <option value="zh">中文</option>
      <option value="vi">Tiếng Việt</option>
    </select>

    <label>Birth Date / 생년월일</label>
    <div class="row">
      <input type="number" id="year" placeholder="1990" value="1983">
      <input type="number" id="month" placeholder="1-12" value="3" min="1" max="12">
      <input type="number" id="day" placeholder="1-31" value="23" min="1" max="31">
    </div>

    <label>Birth Time / 태어난 시간</label>
    <select id="birthTime">
      <option value="">모름</option>
      <option value="자시(23:00-01:00)">자시 (23:00-01:00)</option>
      <option value="축시(01:00-03:00)">축시 (01:00-03:00)</option>
      <option value="인시(03:00-05:00)">인시 (03:00-05:00)</option>
      <option value="묘시(05:00-07:00)">묘시 (05:00-07:00)</option>
      <option value="진시(07:00-09:00)">진시 (07:00-09:00)</option>
      <option value="사시(09:00-11:00)">사시 (09:00-11:00)</option>
      <option value="오시(11:00-13:00)" selected>오시 (11:00-13:00)</option>
      <option value="미시(13:00-15:00)">미시 (13:00-15:00)</option>
      <option value="신시(15:00-17:00)">신시 (15:00-17:00)</option>
      <option value="유시(17:00-19:00)">유시 (17:00-19:00)</option>
      <option value="술시(19:00-21:00)">술시 (19:00-21:00)</option>
      <option value="해시(21:00-23:00)">해시 (21:00-23:00)</option>
    </select>

    <label>Gender / 성별</label>
    <select id="gender">
      <option value="male">남성 / Male</option>
      <option value="female">여성 / Female</option>
    </select>

    <div id="consultationFields" style="display:none;">
      <label>Consultation Type / 상담 유형</label>
      <select id="consultationType">
        <option value="general">종합 운세</option>
        <option value="career">직업/사업운</option>
        <option value="love">연애/결혼운</option>
        <option value="wealth">재물/투자운</option>
        <option value="health">건강운</option>
      </select>

      <label>Current Situation / 현재 상황</label>
      <textarea id="currentSituation" rows="2" placeholder="예: 현재 직장에서 5년째 근무 중입니다..."></textarea>

      <label>Specific Question / 구체적인 질문</label>
      <textarea id="specificQuestion" rows="2" placeholder="예: 올해 이직을 해도 될까요?"></textarea>
    </div>

    <button onclick="testAPI()">Get Fortune Reading</button>
  </div>

  <div class="card">
    <h3>API Response</h3>
    <div id="result">결과가 여기에 표시됩니다...</div>
  </div>

  <script>
    let currentAPI = 'fortune';

    function setAPI(type) {
      currentAPI = type;
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');
      document.getElementById('consultationFields').style.display = type === 'consultation' ? 'block' : 'none';
    }

    // Simple saju calculator (simplified for testing)
    function calculateSaju(year, month, day) {
      const stems = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸'];
      const branches = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'];
      const stemKorean = ['갑', '을', '병', '정', '무', '기', '경', '신', '임', '계'];
      const branchKorean = ['자', '축', '인', '묘', '진', '사', '오', '미', '신', '유', '술', '해'];
      const elements = ['Wood', 'Wood', 'Fire', 'Fire', 'Earth', 'Earth', 'Metal', 'Metal', 'Water', 'Water'];

      // Simplified calculation
      const yearStemIdx = (year - 4) % 10;
      const yearBranchIdx = (year - 4) % 12;
      const monthStemIdx = (yearStemIdx * 2 + month) % 10;
      const monthBranchIdx = (month + 1) % 12;
      const dayStemIdx = Math.floor((year * 365.25 + month * 30.44 + day) % 10);
      const dayBranchIdx = Math.floor((year * 365.25 + month * 30.44 + day) % 12);

      return {
        birthDate: { year, month, day },
        fourPillars: {
          year: { stem: stems[yearStemIdx], branch: branches[yearBranchIdx], korean: stemKorean[yearStemIdx] + branchKorean[yearBranchIdx], element: elements[yearStemIdx] },
          month: { stem: stems[monthStemIdx], branch: branches[monthBranchIdx], korean: stemKorean[monthStemIdx] + branchKorean[monthBranchIdx], element: elements[monthStemIdx] },
          day: { stem: stems[dayStemIdx], branch: branches[dayBranchIdx], korean: stemKorean[dayStemIdx] + branchKorean[dayBranchIdx], element: elements[dayStemIdx] },
          hour: { stem: stems[5], branch: branches[6], korean: '기오', element: 'Earth' }
        },
        dayMaster: {
          stem: stems[dayStemIdx],
          korean: stemKorean[dayStemIdx],
          element: elements[dayStemIdx],
          yin: dayStemIdx % 2 === 1
        },
        elementBalance: {
          wood: 2,
          fire: 3,
          earth: 1,
          metal: 1,
          water: 1
        }
      };
    }

    async function testAPI() {
      const btn = document.querySelector('button:not(.tab)');
      const resultDiv = document.getElementById('result');

      btn.disabled = true;
      resultDiv.innerHTML = '<div class="loading"><div class="spinner"></div><p>Generating fortune...</p></div>';

      const year = parseInt(document.getElementById('year').value);
      const month = parseInt(document.getElementById('month').value);
      const day = parseInt(document.getElementById('day').value);
      const sajuData = calculateSaju(year, month, day);
      sajuData.gender = document.getElementById('gender').value;
      sajuData.birthTime = document.getElementById('birthTime').value;

      let endpoint, body;

      if (currentAPI === 'fortune') {
        endpoint = '/api/fortune';
        body = {
          sajuData,
          language: document.getElementById('language').value
        };
      } else {
        endpoint = '/api/saju-consultation';
        body = {
          sajuData,
          consultationType: document.getElementById('consultationType').value,
          currentSituation: document.getElementById('currentSituation').value,
          specificQuestion: document.getElementById('specificQuestion').value,
          language: document.getElementById('language').value
        };
      }

      try {
        const response = await fetch(endpoint, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(body)
        });

        const result = await response.json();
        resultDiv.textContent = JSON.stringify(result, null, 2);
      } catch (error) {
        resultDiv.textContent = 'Error: ' + error.message;
      }

      btn.disabled = false;
    }
  </script>
</body>
</html>
